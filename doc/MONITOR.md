# MONITOR

目标是为了验证基于SCX修改后的**调度算法在高负载下是否真的能提升并行应用性能**。因此该eBPF监控器本质上是一个“调度效果分析器”。主要可以展示任务的整体执行效率，也可以揭示出任务调度的微观行为。

希望这个监控器可以：在运行 OpenMP 并行 benchmark（例如 `c_loopB.badSolution1.c`）时，结合修改的 SCX 调度器，用 eBPF 监控迭代执行过程，分析调度策略对任务行为的影响。

## sched_ext(SCX)

在着手监控系统前，先了解调度器的相关知识。

**`SCX_OPS_DEFINE`** 宏定义了调度器操作的结构体，其中的钩子函数是调度器的核心逻辑。

- `select_cpu`:为任务选择目标CPU，在任务唤醒或迁移时调用

- `enqueue`:将任务放入调度器的队列中，必选，自定义任务队列管理（如优先级队列、时间片轮转）

- `dispatch`:从队列中取出任务并分配给CPU，必选，决定下一个要运行的任务（如公平调度、实时优先级）

- `running`:任务开始在某CPU上运行时调用，统计任务运行时间、更新调度状态

- `stopping`:任务被抢占或自愿让出CPU时调用，清理任务状态、记录上下文切换信息

- `init`:调度器初始化时调用（仅一次），释放资源、打印统计信息

- `exit`:调度器退出时调用（仅一次），释放资源、打印统计信息

- `name`：调度器的名称（字符串），调试时识别调度器

## 监控详情

### 宏观状态

主要是从用户空间程序代码出发，打入uprobe探针，

### 监控目标

- 上下文切换：sched_switch事件详情

- CPU负载均衡：跨核任务迁移频率

- 调度延迟：任务从就绪到实际运行的时间

- 锁竞争：futex/spinlock等待时间

- OpenMP特定事件：并行区开始/结束，任务窃取

- 以及有待补充

![](C:\Users\86137\AppData\Roaming\marktext\images\2025-04-22-21-57-14-image.png)
